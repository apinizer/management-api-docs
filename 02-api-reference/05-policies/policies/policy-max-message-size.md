# Max Message Size Policy

## General Information

### Policy Type
```
policy-max-message-size
```

### UI Documentation
> ðŸ“– **For detailed information:** [UI Documentation Link - Link will be added here]

### Description
Max Message Size policy limits the maximum size of request or response messages. Messages exceeding the specified size are rejected before processing. This policy helps prevent DoS attacks and ensures efficient resource usage.

### Endpoints

#### List Policies
```
GET /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/
```

#### Add Policy
```
POST /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/{policyName}/
```

#### Update Policy
```
PUT /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/{policyName}/
```

#### Delete Policy
```
DELETE /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/{policyName}/
```

---

## List Policies

### Endpoint
```
GET /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/
```

### Request

#### Headers
| Header | Value |
|--------|-------|
| Authorization | Bearer {token} |

#### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectName | string | Yes | Project name |
| apiProxyName | string | Yes | API Proxy name |

### Response

#### Success Response (200 OK)
```json
{
  "success": true,
  "resultList": [
    {
      "apiProxy": {
        "name": "MyAPI",
        "requestPolicyList": [
          {
            "type": "policy-max-message-size",
            "name": "max-size-policy",
            "description": "Limit request size to 1MB",
            "active": true,
            "maxMessageSize": 1048576
          }
        ],
        "responsePolicyList": [],
        "errorPolicyList": []
      }
    }
  ],
  "resultCount": 1
}
```

### cURL Example
```bash
curl -X GET \
  "https://demo.apinizer.com/apiops/projects/MyProject/apiProxies/MyAPI/policies/" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## Add Policy

### Endpoint
```
POST /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/{policyName}/
```

### Request

#### Headers
| Header | Value |
|--------|-------|
| Authorization | Bearer {token} |
| Content-Type | application/json |

#### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectName | string | Yes | Project name |
| apiProxyName | string | Yes | API Proxy name |
| policyName | string | Yes | Policy name |

#### Request Body

##### Full JSON Body Example
```json
{
  "operationMetadata": {
    "targetScope": "ALL",
    "targetPipeline": "REQUEST",
    "deploy": true,
    "deployTargetEnvironmentNameList": ["production"],
    "order": 1
  },
  "policy": {
    "type": "policy-max-message-size",
    "description": "Limit request message size to 1MB",
    "active": true,
    "maxMessageSize": 1048576
  }
}
```

##### Request Body Fields

###### operationMetadata
| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| targetScope | string | Yes | - | Policy scope: `ALL` or `ENDPOINT` |
| targetEndpoint | string | No* | - | Endpoint path (required if targetScope=ENDPOINT) |
| targetEndpointHTTPMethod | string | No* | - | HTTP method (required if targetScope=ENDPOINT) |
| targetPipeline | string | Yes | - | Pipeline: `REQUEST`, `RESPONSE`, or `ERROR` |
| deploy | boolean | No | true | Whether to deploy after adding policy |
| deployTargetEnvironmentNameList | array | No | [] | List of environment names to deploy to |
| order | integer | No | null | Policy execution order (starts from 1) |

**Enum: targetScope**
- `ALL` - Policy applies to all endpoints
- `ENDPOINT` - Policy applies only to specified endpoint

**Enum: targetPipeline**
- `REQUEST` - Executes in request pipeline (limits request body size)
- `RESPONSE` - Executes in response pipeline (limits response body size)
- `ERROR` - Executes in error pipeline

**Enum: targetEndpointHTTPMethod**
- `GET`, `POST`, `PUT`, `DELETE`, `PATCH`, `OPTIONS`, `HEAD`

###### policy
| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| type | string | Yes | - | Policy type: `policy-max-message-size` |
| description | string | No | - | Policy description |
| active | boolean | No | true | Whether policy is active |
| maxMessageSize | long | Yes | - | Maximum message size in bytes |

**Size Examples:**
- `1024` - 1 KB
- `1048576` - 1 MB (1024 * 1024)
- `10485760` - 10 MB
- `104857600` - 100 MB

**Note:** 
- `maxMessageSize` must be greater than 0.
- Size is measured in bytes.
- Messages exceeding this size are rejected with an error.

### Response

#### Success Response (200 OK)
```json
{
  "success": true,
  "deploymentResult": {
    "success": true,
    "deploymentResults": [
      {
        "environmentName": "production",
        "success": true,
        "message": "Deployment successful"
      }
    ]
  }
}
```

### cURL Example
```bash
curl -X POST \
  "https://demo.apinizer.com/apiops/projects/MyProject/apiProxies/MyAPI/policies/max-size-policy/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "operationMetadata": {
      "targetScope": "ALL",
      "targetPipeline": "REQUEST",
      "deploy": true,
      "deployTargetEnvironmentNameList": ["production"],
      "order": 1
    },
    "policy": {
      "type": "policy-max-message-size",
      "description": "Limit request message size to 1MB",
      "active": true,
      "maxMessageSize": 1048576
    }
  }'
```

---

## Update Policy

### Endpoint
```
PUT /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/{policyName}/
```

### Request

#### Headers
| Header | Value |
|--------|-------|
| Authorization | Bearer {token} |
| Content-Type | application/json |

#### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectName | string | Yes | Project name |
| apiProxyName | string | Yes | API Proxy name |
| policyName | string | Yes | Policy name |

#### Request Body

##### Full JSON Body Example
```json
{
  "operationMetadata": {
    "targetScope": "ALL",
    "targetPipeline": "REQUEST",
    "deploy": true,
    "deployTargetEnvironmentNameList": ["production"],
    "order": 1
  },
  "policy": {
    "type": "policy-max-message-size",
    "description": "Updated - limit request size to 5MB",
    "active": true,
    "maxMessageSize": 5242880
  }
}
```

**Note:** Request body structure is the same as Add Policy. All fields should be provided for update.

### Response

#### Success Response (200 OK)
```json
{
  "success": true,
  "deploymentResult": {
    "success": true,
    "deploymentResults": [
      {
        "environmentName": "production",
        "success": true,
        "message": "Deployment successful"
      }
    ]
  }
}
```

### cURL Example
```bash
curl -X PUT \
  "https://demo.apinizer.com/apiops/projects/MyProject/apiProxies/MyAPI/policies/max-size-policy/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "operationMetadata": {
      "targetScope": "ALL",
      "targetPipeline": "REQUEST",
      "deploy": true,
      "deployTargetEnvironmentNameList": ["production"],
      "order": 1
    },
    "policy": {
      "type": "policy-max-message-size",
      "description": "Updated - limit request size to 5MB",
      "active": true,
      "maxMessageSize": 5242880
    }
  }'
```

---

## Delete Policy

### Endpoint
```
DELETE /apiops/projects/{projectName}/apiProxies/{apiProxyName}/policies/{policyName}/
```

### Request

#### Headers
| Header | Value |
|--------|-------|
| Authorization | Bearer {token} |
| Content-Type | application/json |

#### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| projectName | string | Yes | Project name |
| apiProxyName | string | Yes | API Proxy name |
| policyName | string | Yes | Policy name |

#### Request Body

##### Full JSON Body Example
```json
{
  "operationMetadata": {
    "targetScope": "ALL",
    "targetPipeline": "REQUEST",
    "deploy": false
  }
}
```

##### Request Body Fields

###### operationMetadata
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| targetScope | string | Yes | Policy scope: `ALL` or `ENDPOINT` |
| targetPipeline | string | Yes | Pipeline: `REQUEST`, `RESPONSE`, or `ERROR` |
| deploy | boolean | No | false | Whether to deploy after deletion |

### Response

#### Success Response (200 OK)
```json
{
  "success": true,
  "deploymentResult": {
    "success": true,
    "deploymentResults": []
  }
}
```

### cURL Example
```bash
curl -X DELETE \
  "https://demo.apinizer.com/apiops/projects/MyProject/apiProxies/MyAPI/policies/max-size-policy/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "operationMetadata": {
      "targetScope": "ALL",
      "targetPipeline": "REQUEST",
      "deploy": false
    }
  }'
```

---

## Notes and Warnings

- **Size Limit**: `maxMessageSize` must be greater than 0 (measured in bytes)
- **Size Calculation**: 
  - 1 KB = 1024 bytes
  - 1 MB = 1048576 bytes (1024 * 1024)
  - 1 GB = 1073741824 bytes (1024 * 1024 * 1024)
- **Message Size**: Includes entire request/response body (headers are not counted)
- **Validation**: Size is checked before message is fully processed
- **Error Response**: Messages exceeding the limit are rejected with an error
- **Pipeline**: 
  - `REQUEST` pipeline limits request body size
  - `RESPONSE` pipeline limits response body size
- **Performance**: Early size checking prevents resource exhaustion
- **DoS Protection**: Helps prevent DoS attacks by limiting message size
- **Order**: This policy should typically be executed early in the pipeline (low order number)
- **Deployment**: Policy changes require deployment to take effect. Set `deploy: true` or deploy manually.

## Related Documentation

- [List Policies](../crud/list-policies.md) - List all policies
- [Add Policy](../crud/add-policy.md) - General policy addition guide
- [Update Policy](../crud/update-policy.md) - General policy update guide
- [Delete Policy](../crud/delete-policy.md) - General policy deletion guide
- [Min Message Size Policy](./policy-min-message-size.md) - Set minimum message size
